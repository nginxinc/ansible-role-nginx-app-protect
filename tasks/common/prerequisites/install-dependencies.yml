---
- name: (Alpine Linux) Install package dependencies
  apk:
    name: "{{ nginx_app_protect_alpine_dependencies }}"
    update_cache: true
    state: latest  # noqa package-latest
  when: ansible_os_family == "Alpine"

- name: (Debian/Ubuntu) Install package dependencies
  apt:
    name: "{{ nginx_app_protect_debian_dependencies }}"
    update_cache: true
    state: latest  # noqa package-latest
  when: ansible_os_family == "Debian"

- name: (Amazon Linux/CentOS/RHEL) Install dependencies
  block:
    - name: (Amazon Linux/CentOS/RHEL) Install dependencies
      yum:
        name: "{{ nginx_app_protect_redhat_dependencies }}"
        update_cache: true
        state: latest  # noqa package-latest

    - name: (Amazon Linux/CentOS/RHEL) Set up dependencies repository
      yum_repository:
        name: dependencies
        baseurl: "https://pkgs.nginx.com/epel/7/$basearch/"
        description: NGINX App Protect dependencies
        enabled: true
        gpgcheck: false
        sslclientcert: /etc/ssl/nginx/nginx-repo.crt
        sslclientkey: /etc/ssl/nginx/nginx-repo.key
      when: not nginx_app_protect_use_rhel_subscription_repos | bool

    - name: (RHEL) Install package dependencies from your RHEL subscription
      yum:
        name:
          - rhel-7-server-optional-rpms
          - rhel-7-server-rpms
        update_cache: true
        state: latest  # noqa package-latest
      when: nginx_app_protect_use_rhel_subscription_repos | bool

    - name: (Amazon Linux) Enable Amazon Linux Extras dependencies
      command: "amazon-linux-extras enable {{ item }}"
      changed_when: false
      loop: "{{ nginx_app_protect_amazon_extras }}"
      when: ansible_distribution == "Amazon"
  when: ansible_os_family == "RedHat"
